/*!
* FooBar - Notification Bars, Done Right!
* http://bit.ly/getfoobar
*
* Copyright 2012, Steven Usher & Brad Vincent
* http://themergency.com
*
* Date: 11 April 2012
* Version : 2.3
*/

(function($){window.foobar=window.$foobar=$.foobar=function(){return fb.init.apply(this,arguments)};$.foobarGoogleCallback=function(){fb.googleApi.load.feeds()};var defaults={"height":{"bar":30,"button":30},"width":{"left":"*","center":"50%","right":"*","button":"80px"},"position":{"ignoreOffsetMargin":false,"bar":"top","button":"right","social":"left"},"display":{"type":"expanded","delay":0,"speed":250,"backgroundColor":"#6c9e00","border":"solid 3px #FFF","button":{"type":"toggle","spacer":true,"backgroundColor":null,"border":null},"theme":{"bar":"triangle-arrow","navigation":null},"easing":"swing","shadow":true,"adjustPageHeight":true,"rtl":false},"cookie":{"enabled":false,"name":"foobar-state","duration":1,"version":1},"messages":[],"message":{"delay":4000,"fadeDelay":300,"random":false,"navigation":false,"cssClass":null,"scroll":{"enabled":true,"speed":50,"delay":2000},"font":{"family":"Verdana","size":"10pt","color":"White","decoration":null,"shadow":null,"weight":null},"aFont":{"family":"Verdana","size":"10pt","color":"LightYellow","decoration":"underline","shadow":null,"weight":null,"hover":{"family":null,"size":null,"color":null,"decoration":null,"shadow":null,"weight":null}}},"rightHtml":null,"leftHtml":null,"social":{"text":"Follow us","cssClass":null,"font":{"family":"Verdana","size":"10pt","color":"White","decoration":null,"shadow":null,"weight":null},"profiles":[]},"rss":{"enabled":false,"url":null,"maxResults":5,"linkText":"Read More","linkTarget":"_blank"},"twitter":{"enabled":false,"user":null,"maxTweets":5},"events":{"expanding":null,"collapsing":null,"setExpanded":null,"setCollapsed":null,"preRender":null,"postRender":null},"ssl":false};var fb={settings:{},elements:{main:{wrapper:null,shadow:null,container:null,row:null},left:{container:null,inner:null},center:{container:null,inner:null},right:{container:null,inner:null},message:null,open:{button:null,container:null},close:{button:null,container:null,spacer:null},prev:null,next:null},_internals:{state:{firstrun:true,initialized:false,open:false,top:false,busy:false},offsetMargin:0,actualHeight:0,shadowHeight:5,tabShadowHeight:11},utils:{isNotNullOrEmpty:function(value){return(typeof value=='string'&&value!==null&&value!=='')},preventDefault:function(obj){if(typeof obj!='undefined'&&obj!==null&&typeof obj.preventDefault=='function'){obj.preventDefault()}},applyFont:function(elements,font){var def={'family':null,'size':null,'color':null,'decoration':null,'shadow':null};var f=$.extend({},def,font);if(fb.utils.isNotNullOrEmpty(f.family)){elements.css('font-family',f.family)}if(fb.utils.isNotNullOrEmpty(f.size)){elements.css('font-size',f.size)}if(fb.utils.isNotNullOrEmpty(f.color)){elements.css('color',f.color)}if(fb.utils.isNotNullOrEmpty(f.decoration)){elements.css('text-decoration',f.decoration)}if(fb.utils.isNotNullOrEmpty(f.shadow)){elements.css('text-shadow',f.shadow)}if(fb.utils.isNotNullOrEmpty(f.weight)){elements.css('font-weight',f.weight)}},setCookie:function(expanded){var expires='';if(fb.settings.cookie.duration){var date=new Date();date.setTime(date.getTime()+(fb.settings.cookie.duration*24*60*60*1000));expires='; expires='+date.toGMTString()}document.cookie=fb.settings.cookie.name+'='+expanded+'|'+fb.settings.cookie.version+expires+'; path=/'},getCookie:function(){var nameEq=fb.settings.cookie.name+'=';var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEq)===0)return fb.utils.parse.cookie(c.substring(nameEq.length,c.length))}return null},deleteCookie:function(){var date=new Date();date.setTime(date.getTime()+(-1*24*60*60*1000));document.cookie=fb.settings.cookie.name+'=; expires='+date.toGMTString()+'; path=/'},formatTweetHtml:function(tweet){var tweetPrefix=fb.settings.twitter.user+': ';if(tweet.indexOf(tweetPrefix)===0){tweet=tweet.substring(tweetPrefix.length)}tweet=' '+tweet;tweet=tweet.replace(/\b(((https*\:\/\/)|www\.)[^\"\']+?)(([!?,.\)]+)?(\s|$))/g,function(link,m1,m2,m3,m4){var http=m2.match(/w/)?'http://':'';return'<a class="twtr-hyperlink" target="_blank" href="'+http+m1+'">'+m1+'</a>'+m4});tweet=tweet.replace(/\B[@＠]([a-zA-Z0-9_]{1,20})/g,function(m,username){return'<a target="_blank" class="twtr-atreply" href="http://twitter.com/intent/user?screen_name='+username+'">@'+username+'</a>'});tweet=tweet.replace(/\B[@＠]([a-zA-Z0-9_]{1,20}\/\w+)/g,function(m,userlist){return'<a target="_blank" class="twtr-atreply" href="http://twitter.com/'+userlist+'">@'+userlist+'</a>'});tweet=tweet.replace(/(^|\s+)#(\w+)/gi,function(m,before,hash){return before+'<a target="_blank" class="twtr-hashtag" href="http://twitter.com/search?q=%23'+hash+'">#'+hash+'</a>'});return tweet},raise:function(handler){try{if($.isFunction(handler)){var args=Array.prototype.slice.call(arguments);args.shift();handler.apply(fb,args)}}catch(err){console.error(err)}},parse:{cookie:function(value){if(typeof value==='string'){if(value.indexOf('|')==-1){return{expanded:fb.utils.parse.bool(value,false),version:-1}}else{var parts=value.split('|');if(parts.length==2){return{expanded:fb.utils.parse.bool(parts[0],false),version:fb.utils.parse.integer(parts[1],-1)}}}}return null},bool:function(value,def){def=def||false;switch(typeof value){case'string':{switch(value.toLowerCase()){case'1':case'true':return true;case'0':case'false':return false;default:return def}}case'number':{switch(value){case 1:return true;case 0:return false;default:return def}}case'boolean':return value;default:return def}},integer:function(value,def){def=def||null;switch(typeof value){case'string':{var result=parseInt(value);return isNaN(result)?def:result}case'number':return value;default:return def}},html:function(html){if(!fb.utils.isNotNullOrEmpty(html)){return html}if(html&&html.match('{{include:(.*?)}}')){var regEx=new RegExp('{{include:(.*?)}}');var match=regEx.exec(html);while(match!==null){var matchedHtml=$(match[1]).html();html=html.replace(match[0],matchedHtml);match=regEx.exec(html)}}return html},width:function(value){return(typeof value!='undefined'&&value!=null&&value!="*"&&value!="100%")?{'width':value}:{'width':'auto'}},borderWidth:function(value,def){var $tmp=$('<div></div>').css({'border':value,'position':'absolute','visibility':'hidden'}).appendTo('body');var w=fb.utils.parse.integer($tmp.css('border-top-width'),def);$tmp.remove();return w}},checks:{isMultipart:function(name,seperator){return(typeof name!='undefined'&&name!==null&&name.length>0&&name.indexOf(seperator)!=-1)},hasProperties:function(obj){if(typeof obj!=='object'){return false}for(var prop in obj){if(obj.hasOwnProperty(prop)){return true}}return false},isArray:function(obj){return Object.prototype.toString.call(obj)==="[object Array]"}},property:{get:function(obj,name){try{if(fb.utils.checks.isMultipart(name,'.')){var propName=name.substring(0,name.indexOf('.'));var remainder=name.substring(name.indexOf('.')+1);obj[propName]=obj[propName]||{};return fb.utils.property.get(obj[propName],remainder)}return obj[name]}catch(err){console.error(err);return null}},set:function(obj,name,value){try{if(fb.utils.checks.isMultipart(name,'.')){var propName=name.substring(0,name.indexOf('.'));var remainder=name.substring(name.indexOf('.')+1);obj[propName]=obj[propName]||{};fb.utils.property.set(obj[propName],remainder,value)}else{obj[name]=value}}catch(err){console.error(err)}},merge:function(base,changes){try{for(var prop in changes){if(changes.hasOwnProperty(prop)){if(fb.utils.checks.hasProperties(changes[prop])&&!fb.utils.checks.isArray(changes[prop])){base[prop]=base[prop]||{};fb.utils.property.merge(base[prop],changes[prop])}else if(fb.utils.checks.isArray(changes[prop])){base[prop]=[];$.extend(true,base[prop],changes[prop])}else{base[prop]=changes[prop]}}}}catch(err){console.error(err)}}}},messageLoop:{id:null,paused:false,sizes:[],index:{current:-1,next:0,_random:function(){if(fb.settings.messages.length<=1){return 0}var from=0,to=fb.settings.messages.length-1;var random=Math.floor(Math.random()*(to-from+1)+from);return(random==fb.messageLoop.index.current)?fb.messageLoop.index._random():random},_setCurrent:function(){if(fb.settings.message.random&&fb.messageLoop.index.current==-1&&fb.settings.messages.length>1){fb.messageLoop.index.current=fb.messageLoop.index._random()}else{fb.messageLoop.index.current=fb.messageLoop.index.next}},_setNext:function(){if(fb.settings.message.random&&fb.settings.messages.length>1){fb.messageLoop.index.next=fb.messageLoop.index._random()}else if(fb.messageLoop.index.next>=(fb.settings.messages.length-1)){fb.messageLoop.index.next=0}else{fb.messageLoop.index.next++}}},create:function(){if($('.foobar-message-wrapper').length!==fb.settings.messages.length||fb.messageLoop.sizes.length!=fb.settings.messages.length){fb.elements.message.empty();for(var mi=0;mi<fb.settings.messages.length;mi++){var $msg=$('<div></div>').attr('id','foobar-message-'+mi).addClass('foobar-message-wrapper').css({'position':'absolute','display':'inline-block','visibility':'hidden'}).html(fb.utils.parse.html(fb.settings.messages[mi]));fb.elements.message.append($msg);fb.messageLoop._style($msg);fb.messageLoop.sizes[mi]={'width':$msg.width(),'height':$msg.height()}}}fb.elements.message.children().hide();fb.elements.center.container.unbind('mouseenter mouseleave');fb.elements.prev.add(fb.elements.next).unbind('click');if(fb.settings.messages.length>1){fb.elements.center.container.hover(fb.messageLoop.pause,fb.messageLoop.resume);fb.elements.prev.click(fb.messageLoop.prev);fb.elements.next.click(fb.messageLoop.next)}},start:function(force){force=force||false;if(!fb._internals.state.open||fb.settings.messages.length===0||fb.messageLoop.index.current==fb.messageLoop.index.next){return}if(!force&&fb.messageLoop.paused){fb.messageLoop.id=setTimeout(fb.messageLoop.start,fb.settings.message.delay);return}fb.messageLoop.stop();fb.messageLoop.index._setCurrent();fb.messageLoop.create();var cWidth=fb.elements.center.container.width();var mWidth=fb.messageLoop.sizes[fb.messageLoop.index.current].width;var mHeight=fb.messageLoop.sizes[fb.messageLoop.index.current].height;$('#foobar-message-'+fb.messageLoop.index.current).css({'position':'static','display':'inline-block','visibility':'visible','opacity':100,'margin-left':0,'width':mWidth,'min-height':mHeight,'max-height':fb.settings.height.bar});fb.elements.message.css({'min-height':mHeight,'max-height':fb.settings.height.bar});fb.messageLoop.index._setNext();if(mWidth>cWidth){fb.messageLoop._scroll((mWidth-cWidth),force)}else if(fb.messageLoop.index.next!=fb.messageLoop.index.current){fb.messageLoop.id=setTimeout(function(){fb.messageLoop._fade(force)},fb.settings.message.delay)}},stop:function(){if(typeof fb.messageLoop.id!='undefined'&&fb.messageLoop.id!==null){clearTimeout(fb.messageLoop.id)}$('#foobar-message-'+fb.messageLoop.index.current).stop(false,false).css('margin-left',0);fb.messageLoop.id=null},pause:function(){if(fb.settings.message.navigation&&!fb.messageLoop.paused){fb.elements.prev.add(fb.elements.next).stop(false,true).fadeIn('fast')}fb.messageLoop.paused=true},resume:function(){if(fb.settings.message.navigation&&fb.messageLoop.paused){fb.elements.prev.add(fb.elements.next).stop(false,true).fadeOut('fast')}fb.messageLoop.paused=false},next:function(){if(fb.settings.messages.length>1){fb.messageLoop.stop();$('#foobar-message-'+fb.messageLoop.index.current).stop(false,false).css('margin-left',0);var index=(fb.messageLoop.index.current+1);index=(index<=(fb.settings.messages.length-1))?index:0;fb.messageLoop.index.next=index;fb.messageLoop.start(true)}},prev:function(){if(fb.settings.messages.length>1){fb.messageLoop.stop();$('#foobar-message-'+fb.messageLoop.index.current).stop(false,false).css('margin-left',0);var index=(fb.messageLoop.index.current-1);index=(index>=0)?index:(fb.settings.messages.length-1);fb.messageLoop.index.next=index;fb.messageLoop.start(true)}},_scroll:function(diff,force){var $message=$('#foobar-message-'+fb.messageLoop.index.current).css('margin-left',(fb.settings.display.rtl?-(diff):0));if(fb.settings.message.scroll.enabled){var speed=Math.round(diff/fb.settings.message.scroll.speed)*1000; var animation={'margin-left':(fb.settings.display.rtl?0:-(diff))};$message.delay(fb.settings.message.scroll.delay).animate(animation,speed,'linear',function(){if(fb.messageLoop.index.next==fb.messageLoop.index.current){fb.messageLoop.id=setTimeout(function(){fb.messageLoop._reset(force)},fb.settings.message.delay)}else{fb.messageLoop.id=setTimeout(function(){fb.messageLoop._fade(force)},fb.settings.message.delay)}})}},_reset:function(force){force=force||false;if(fb.messageLoop.paused){fb.messageLoop.id=setTimeout(function(){fb.messageLoop._reset(force)},fb.settings.message.delay);return}$('#foobar-message-'+fb.messageLoop.index.current).stop(false,false).css('margin-left',0);fb.messageLoop.index.current=-1;fb.messageLoop.start(force)},_fade:function(force){force=force||false;if(fb.messageLoop.paused){fb.messageLoop.id=setTimeout(function(){fb.messageLoop._fade(force)},fb.settings.message.delay);return}$('#foobar-message-'+fb.messageLoop.index.current).animate({'opacity':0},fb.settings.message.fadeDelay,function(){fb.messageLoop.start(force)})},_style:function(message){if(fb.utils.isNotNullOrEmpty(fb.settings.message.cssClass)){message.addClass(fb.settings.message.cssClass)}else{fb.utils.applyFont(message,fb.settings.message.font);var $a=message.find('a');fb.utils.applyFont($a,fb.settings.message.aFont);$a.unbind('mouseenter mouseleave').bind({mouseenter:function(){fb.utils.applyFont($(this),fb.settings.message.aFont.hover)},mouseleave:function(){fb.utils.applyFont($(this),fb.settings.message.aFont)}})}}},googleApi:{check:{core:function(){return(typeof google!='undefined')},feeds:function(){return(fb.googleApi.check.core()&&typeof google.feeds!='undefined')}},load:{core:function(){var protocol=fb.settings.ssl?'https':'http';$('<script></script>').attr('type','text/javascript').attr('src',protocol+'://www.google.com/jsapi?callback=jQuery.foobarGoogleCallback').appendTo('head')},feeds:function(){google.load('feeds','1',{'callback':fb.googleApi.fetch.messages})}},fetch:{messages:function(){if(fb.settings.twitter.enabled&&fb.utils.isNotNullOrEmpty(fb.settings.twitter.user)){fb.googleApi.fetch.twitter()}if(fb.settings.rss.enabled&&fb.utils.isNotNullOrEmpty(fb.settings.rss.url)){fb.googleApi.fetch.rss()}},twitter:function(){var twitterRssUrl='http://api.twitter.com/1/statuses/user_timeline.rss?trim_user=0&screen_name='+fb.settings.twitter.user;var feed=new google.feeds.Feed(twitterRssUrl);feed.setNumEntries(fb.settings.twitter.maxTweets);feed.load(function(result){fb.messageLoop.stop();if(!result.error){for(var i=0;i<result.feed.entries.length;i++){var tweet=fb.utils.formatTweetHtml(result.feed.entries[i].title);fb.settings.messages.push(tweet)}}else{console.error(result.error.message)}fb.elements.message.stop(false,true).css({'left':0,'opacity':100});fb.messageLoop.start(true)})},rss:function(){var feed=new google.feeds.Feed(fb.settings.rss.url);feed.setNumEntries(fb.settings.rss.maxResults);feed.load(function(result){fb.messageLoop.stop();if(!result.error){for(var i=0;i<result.feed.entries.length;i++){var msg=result.feed.entries[i].title;if(fb.utils.isNotNullOrEmpty(fb.settings.rss.linkText)){msg+=' <a href="'+result.feed.entries[i].link+'" target="'+fb.settings.rss.linkTarget+'">'+fb.settings.rss.linkText+'</a>'}fb.settings.messages.push(msg)}}else{console.error(result.error.message)}fb.elements.message.stop(false,true).css({'left':0,'opacity':100});fb.messageLoop.start(true)})}}},init:function(arg1,arg2,arg3){if(typeof arg1==='string'){switch(arg1){case'open':fb.expand(null);break;case'close':fb.collapse(null);break;case'toggle':fb.toggle();break;case'destroy':fb.destroy();break;case'prev':fb.messageLoop.prev();break;case'next':fb.messageLoop.next();break;case'start':fb.messageLoop.start();break;case'stop':fb.messageLoop.stop();break;case'option':{switch(arguments.length){case 3:fb.option.set(arg2,arg3);break;case 2:{if(typeof arg2==='string'){return fb.option.get(arg2)}fb.option.set(arg2,null)}}break}default:fb.render($.extend(true,{},defaults,{'messages':[arg1]}));break}}else{fb.render($.extend(true,{},defaults,arg1))}return false},create:function(){if($('.foobar-wrapper').length===0){fb.elements.main.wrapper=$('<div></div>').addClass('foobar-wrapper');fb.elements.main.container=$('<table></table>').attr({'cellpadding':0,'cellspacing':0}).addClass('foobar-container');fb.elements.main.row=$('<tr></tr>').addClass('foobar-container-row');fb.elements.main.shadow=$('<div></div>').addClass('foobar-shadow');fb.elements.left.container=$('<td></td>').addClass('foobar-container-left');fb.elements.left.inner=$('<div></div>').addClass('foobar-container-inner');fb.elements.center.container=$('<td></td>').addClass('foobar-container-center');fb.elements.center.inner=$('<div></div>').addClass('foobar-container-inner');fb.elements.right.container=$('<td></td>').addClass('foobar-container-right');fb.elements.right.inner=$('<div></div>').addClass('foobar-container-inner');fb.elements.prev=$('<div></div>').addClass('foobar-prev-button');fb.elements.next=$('<div></div>').addClass('foobar-next-button');fb.elements.message=$('<div></div>').addClass('foobar-message');fb.elements.close.spacer=$('<td></td>').addClass('foobar-close-button-spacer');fb.elements.close.container=$('<td></td>').addClass('foobar-close-button-container');fb.elements.close.button=$('<span></span>').addClass('foobar-close-button');fb.elements.open.container=$('<div></div>').addClass('foobar-open-button-container');fb.elements.open.button=$('<span></span>').addClass('foobar-open-button');fb.elements.main.wrapper.append(fb.elements.main.container.append(fb.elements.main.row)).append(fb.elements.main.shadow).append(fb.elements.open.container);fb.elements.main.row.append(fb.elements.left.container.append(fb.elements.left.inner)).append(fb.elements.center.container.append(fb.elements.center.inner.append(fb.elements.message).append(fb.elements.prev).append(fb.elements.next))).append(fb.elements.right.container.append(fb.elements.right.inner)).append(fb.elements.close.container);fb.elements.close.container.append(fb.elements.close.button);fb.elements.open.container.append(fb.elements.open.button);$('body').prepend(fb.elements.main.wrapper)}else{fb.elements.main.wrapper=$('.foobar-wrapper');fb.elements.main.container=$('.foobar-container');fb.elements.main.row=$('.foobar-container-row');fb.elements.main.shadow=$('.foobar-shadow');fb.elements.left.container=$('.foobar-container-left');fb.elements.left.inner=$('.foobar-container-left .foobar-container-inner');fb.elements.center.container=$('.foobar-container-center');fb.elements.center.inner=$('.foobar-container-center .foobar-container-inner');fb.elements.right.container=$('.foobar-container-right');fb.elements.right.inner=$('.foobar-container-right .foobar-container-inner');fb.elements.prev=$('.foobar-prev-button');fb.elements.next=$('.foobar-next-button');fb.elements.message=$('.foobar-message');fb.elements.close.spacer=$('.foobar-close-button-spacer');fb.elements.close.container=$('.foobar-close-button-container');fb.elements.close.button=$('.foobar-close-button');fb.elements.open.container=$('.foobar-open-button-container');fb.elements.open.button=$('.foobar-open-button')}fb._internals.state.initialized=true},_render:{allow:function(){var cookie=fb.utils.getCookie();if(cookie!=null&&cookie.version==fb.settings.cookie.version&&fb.settings.cookie.enabled&&!cookie.expanded&&fb.settings.display.button.type=='close'){fb.destroy();return false}else if(cookie!=null&&cookie.version!=fb.settings.cookie.version&&fb.settings.cookie.enabled&&!cookie.expanded&&fb.settings.display.button.type=='close'){fb.utils.deleteCookie()}return true},init:function(){fb._internals.state.top=fb.settings.position.bar!='bottom';if(!fb._internals.state.initialized){fb._internals.offsetMargin=fb.utils.parse.integer($('html').css(fb._internals.state.top?'margin-top':'margin-bottom'),0);fb._internals.offsetMargin=fb.settings.position.ignoreOffsetMargin?0:fb._internals.offsetMargin;fb.create()}else{fb.elements.left.inner.add(fb.elements.right.inner).empty()}if(fb.settings.display.button.type=='close'){fb.elements.open.container.addClass('hidden')}else{fb.elements.open.container.removeClass('hidden')}fb.elements.main.container.show()},theme:function(){if(fb.settings.display.theme.navigation==null){fb.settings.display.theme.navigation=fb.settings.display.theme.bar}fb.elements.main.wrapper.removeClass().addClass(fb.settings.display.theme.bar).addClass('foobar-wrapper');fb.elements.prev.removeClass().addClass(fb.settings.display.theme.navigation).addClass('foobar-prev-button');fb.elements.next.removeClass().addClass(fb.settings.display.theme.navigation).addClass('foobar-next-button')},backgroundColor:function(){if(fb.settings.display.button.backgroundColor==null){fb.settings.display.button.backgroundColor=fb.settings.display.backgroundColor}fb.elements.main.container.add(fb.elements.prev).add(fb.elements.next).add(fb.elements.open.button).css({'background-color':fb.settings.display.backgroundColor});fb.elements.open.button.css({'background-color':fb.settings.display.button.backgroundColor})},shadow:function(){if(fb.settings.display.shadow){fb.elements.main.wrapper.addClass('shadow')}else{fb.elements.main.wrapper.removeClass('shadow')}fb._internals.shadowHeight=fb.elements.main.shadow.height()},border:function(){if(fb.settings.display.button.border==null){fb.settings.display.button.border=fb.settings.display.border}fb.elements.main.container.css('border','none').css(fb._internals.state.top?'border-bottom':'border-top',fb.settings.display.border);fb.elements.open.button.css('border',fb.settings.display.button.border).css((fb._internals.state.top?'border-top':'border-bottom'),'none')},height:function(){fb.elements.open.container.height(fb.settings.height.button+fb._internals.tabShadowHeight);fb.elements.open.button.height(fb.settings.height.button);fb.elements.main.container.add(fb.elements.close.button).add(fb.elements.prev).add(fb.elements.next).add(fb.elements.left.container).add(fb.elements.center.container).add(fb.elements.right.container).height(fb.settings.height.bar);fb.elements.left.inner.add(fb.elements.center.inner).add(fb.elements.right.inner).css('max-height',fb.settings.height.bar);var borderWidth=fb.utils.parse.borderWidth(fb.settings.display.border,0);fb._internals.actualHeight=fb.settings.height.bar+fb._internals.shadowHeight+borderWidth;fb.elements.main.wrapper.height(fb._internals.actualHeight);fb.elements.prev.add(fb.elements.next).css('margin-top',-(fb.settings.height.bar/2))},position:function(){fb.elements.main.wrapper.removeClass('fb-inline fb-top fb-bottom').addClass('fb-'+fb.settings.position.bar);if(!fb._internals.state.top){fb.elements.main.container.before(fb.elements.main.shadow)}else{fb.elements.main.container.after(fb.elements.main.shadow)}fb.elements.main.wrapper.add(fb.elements.open.container).css((fb._internals.state.top?'bottom':'top'),'auto').css((fb._internals.state.top?'top':'bottom'),(fb.settings.position.bar=='inline')?0:fb._internals.offsetMargin);var borderWidth=fb.utils.parse.borderWidth(fb.settings.display.button.border,0);var marginLeft=-((fb.elements.open.button.width()/2)+borderWidth);fb.elements.open.button.css('margin-left',marginLeft);fb.elements.close.spacer.detach();fb.elements.left.container.css(fb.utils.parse.width(fb.settings.width.left));fb.elements.center.container.css(fb.utils.parse.width(fb.settings.width.center));fb.elements.right.container.css(fb.utils.parse.width(fb.settings.width.right));fb.elements.close.container.add(fb.elements.close.spacer).add(fb.elements.open.container).css(fb.utils.parse.width(fb.settings.width.button));if(fb.settings.position.button=='right'){if(fb.settings.display.button.spacer){fb.elements.close.spacer.insertBefore(fb.elements.center.container)}fb.elements.close.container.insertAfter(fb.elements.right.container).show();fb.elements.open.container.css({'left':'auto','right':'0px'}).show()}else if(fb.settings.position.button=='left'){if(fb.settings.display.button.spacer){fb.elements.close.spacer.insertAfter(fb.elements.center.container)}fb.elements.close.container.insertBefore(fb.elements.left.container).show();fb.elements.open.container.css({'right':'auto','left':'0px'}).show()}else{fb.elements.close.container.hide();fb.elements.open.container.hide()}},social:function(){if(fb.settings.position.social=='left'||fb.settings.position.social=='right'){if(fb.settings.social.profiles.length>0){var $social=$('.foobar-social').length>0?$('.foobar-social'):$('<ul></ul>').addClass('foobar-social');$social.empty();if(fb.utils.isNotNullOrEmpty(fb.settings.social.text)){var $text=$('<li></li>').addClass('foobar-social-text').text(fb.settings.social.text).css({'height':fb.settings.height.bar,'line-height':fb.settings.height.bar+'px'});if(fb.utils.isNotNullOrEmpty(fb.settings.social.cssClass)){$text.addClass(fb.settings.social.cssClass)}else{fb.utils.applyFont($text,fb.settings.social.font)}$social.append($text)}var def={'name':null,'url':null,'image':null,'target':'_blank'};$.each(fb.settings.social.profiles,function(i,p){var profile=$.extend({},def,p);if(profile.name!==null&&profile.url!==null&&profile.image!==null){var $a=$('<a></a>').attr('href',profile.url).attr('title',profile.name).attr('target',profile.target).css({'background':"url('"+profile.image+"') no-repeat center center",'height':fb.settings.height.bar});$social.append($('<li></li>').css({'height':fb.settings.height.bar}).append($a))}});if(fb.settings.position.social=='right'){$social.css('float','right');fb.elements.right.inner.append($social)}else if(fb.settings.position.social=='left'){$social.css('float','left');fb.elements.left.inner.append($social)}$social.children('li').css({'float':(fb.settings.display.rtl?'right':'left'),'text-align':(fb.settings.display.rtl?'right':'left')})}else{$('.foobar-social').remove()}}else{$('.foobar-social').remove()}},customHtml:function(){if(fb.utils.isNotNullOrEmpty(fb.settings.rightHtml)){fb.elements.right.inner.append(fb.utils.parse.html(fb.settings.rightHtml))}if(fb.utils.isNotNullOrEmpty(fb.settings.leftHtml)){fb.elements.left.inner.append(fb.utils.parse.html(fb.settings.leftHtml))}},cookie:function(){var cookie=fb.utils.getCookie();if(cookie===null||cookie.version!=fb.settings.cookie.version||!fb.settings.cookie.enabled){if(!fb.settings.cookie.enabled||(cookie!==null&&cookie.version!=fb.settings.cookie.version)){fb.utils.deleteCookie()}switch(fb.settings.display.type){case'onscroll':fb.setCollapsed();$(window).one('scroll',function(){setTimeout(fb.expand,fb.settings.display.delay)});break;case'delayed':fb.setCollapsed();setTimeout(fb.expand,fb.settings.display.delay);break;case'collapsed':fb.setCollapsed();break;case'expanded':default:fb.setExpanded();break}}else{cookie.expanded?fb.setExpanded():fb.setCollapsed()}},finalise:function(){if(fb.settings.display.button.type=='close'){fb.elements.open.button.unbind().hide();fb.elements.close.button.unbind().click(function(e){fb.collapse(e,fb.destroy)})}else{fb.elements.open.button.unbind().click(fb.expand);fb.elements.close.button.unbind().click(fb.collapse)}$('.foobar-message-wrapper').remove();fb.messageLoop.paused=false;fb.messageLoop.index.next=0;fb.messageLoop.index.current=-1;var handleMessages=true,handleFeeds=false;if(fb.settings.twitter.enabled&&fb.utils.isNotNullOrEmpty(fb.settings.twitter.user)){handleMessages=false;if(fb.googleApi.check.core()&&fb.googleApi.check.feeds()){fb.googleApi.fetch.twitter()}else{handleFeeds=true}}if(fb.settings.rss.enabled&&fb.utils.isNotNullOrEmpty(fb.settings.rss.url)){handleMessages=false;if(fb.googleApi.check.core()&&fb.googleApi.check.feeds()){fb.googleApi.fetch.rss()}else{handleFeeds=true}}if(handleFeeds){if(fb.googleApi.check.feeds()){fb.googleApi.load.feeds()}else{fb.googleApi.load.core()}}if(handleMessages){fb.elements.message.stop(true,false).css('opacity',100);fb.messageLoop.start()}fb._internals.state.firstrun=false;var ua=$.browser;if(ua.msie&&parseInt(ua.version)==8){var display=fb.elements.main.container.css('display');fb.elements.main.container.css({'visibility':'hidden','display':'inline-table'});fb.elements.main.shadow.css('visibility','hidden');setTimeout(function(){fb.elements.main.container.css({'visibility':'visible','display':display});fb.elements.main.shadow.css('visibility','visible')},0)}}},render:function(settings){fb.settings=settings;if(fb._render.allow()){fb.utils.raise(fb.settings.events.preRender,fb.settings);fb._render.init();fb._render.theme();fb._render.backgroundColor();fb._render.shadow();fb._render.border();fb._render.height();fb._render.position();fb._render.social();fb._render.customHtml();fb._render.cookie();fb._render.finalise();fb.utils.raise(fb.settings.events.postRender,fb.settings)}},destroy:function(){if(!fb._internals.state.initialized){return}if(fb.settings.display.adjustPageHeight){var css={'margin-top':0,'margin-bottom':0};if(fb.settings.position.bar!='inline'){css[(fb._internals.state.top?'margin-top':'margin-bottom')]=(fb._internals.offsetMargin<=0)?0:(fb._internals.offsetMargin-fb.settings.height.bar)}else{css[(fb._internals.state.top?'margin-top':'margin-bottom')]=fb._internals.offsetMargin}$('html').css(css)}fb.elements.main.wrapper.remove();fb._internals.state.initialized=false},toggle:function(){if(!fb._internals.state.initialized){return}if(fb._internals.state.open){fb.collapse(null)}else{fb.expand(null)}},expand:function(e){fb.utils.preventDefault(e);if(!fb._internals.state.initialized||fb._internals.state.open||fb._internals.state.busy){return}fb._internals.state.busy=true;fb.elements.open.button.stop(false,true).animate({'height':0},fb.settings.display.speed);fb.elements.open.container.stop(false,true).animate({'height':0},fb.settings.display.speed,function(){if(fb.settings.display.adjustPageHeight){var css={};if(fb.settings.position.bar!='inline'){css[(fb._internals.state.top?'margin-bottom':'margin-top')]=0;var animation={};animation[(fb._internals.state.top?'margin-top':'margin-bottom')]='+='+fb.settings.height.bar;$('html').css(css).stop(false,true).animate(animation,fb.settings.display.speed)}else{css[(fb._internals.state.top?'margin-bottom':'margin-top')]=0;css[(fb._internals.state.top?'margin-top':'margin-bottom')]=fb._internals.offsetMargin;$('html').css(css)}}fb.utils.raise(fb.settings.events.expanding,fb.settings);fb.elements.main.container.show();fb.elements.main.wrapper.stop(false,true).animate({'height':fb._internals.actualHeight},fb.settings.display.speed,fb.settings.display.easing,function(){fb.elements.main.wrapper.focus();fb._internals.state.open=true;fb.messageLoop.start(true);fb._internals.state.busy=false})});if(fb.settings.cookie.enabled){fb.utils.setCookie(true)}},collapse:function(e,callback){fb.utils.preventDefault(e);if(!fb._internals.state.initialized||!fb._internals.state.open||fb._internals.state.busy){return}fb._internals.state.busy=true;fb.messageLoop.stop();if(fb.settings.display.adjustPageHeight){var css={};if(fb.settings.position.bar!='inline'){css[(fb._internals.state.top?'margin-bottom':'margin-top')]=0;var animation={};animation[(fb._internals.state.top?'margin-top':'margin-bottom')]='-='+fb.settings.height.bar;$('html').css(css).stop(false,true).animate(animation,fb.settings.display.speed)}else{css[(fb._internals.state.top?'margin-bottom':'margin-top')]=0;css[(fb._internals.state.top?'margin-top':'margin-bottom')]=fb._internals.offsetMargin;$('html').css(css)}}fb.utils.raise(fb.settings.events.collapsing,fb.settings);fb.elements.main.wrapper.stop(false,true).animate({'height':fb._internals.shadowHeight},fb.settings.display.speed,function(){fb.elements.main.container.hide();fb.elements.open.container.stop(false,true).animate({'height':fb.settings.height.button+fb._internals.tabShadowHeight},fb.settings.display.speed,fb.settings.display.easing);fb.elements.open.button.stop(false,true).animate({'height':fb.settings.height.button},fb.settings.display.speed,fb.settings.display.easing,function(){if($.isFunction(callback)){callback.call()}fb._internals.state.busy=false})});fb._internals.state.open=false;if(fb.settings.cookie.enabled){fb.utils.setCookie(false)}},setExpanded:function(){if(!fb._internals.state.initialized||fb._internals.state.busy){return}fb.elements.main.wrapper.height(fb._internals.actualHeight);fb.elements.main.container.show();fb.elements.open.container.add(fb.elements.open.button).height(0);if(fb.settings.display.adjustPageHeight&&fb.settings.position.bar!='inline'){var css={'margin-top':0,'margin-bottom':0};css[(fb._internals.state.top?'margin-top':'margin-bottom')]=(fb._internals.offsetMargin<=0)?fb.settings.height.bar:(fb._internals.offsetMargin+fb.settings.height.bar);$('html').css(css)}if(fb._internals.state.firstrun||!fb._internals.state.open){fb.utils.raise(fb.settings.events.setExpanded,fb.settings)}fb._internals.state.open=true;if(fb.settings.cookie.enabled){fb.utils.setCookie(true)}},setCollapsed:function(){if(!fb._internals.state.initialized||fb._internals.state.busy){return}fb.elements.main.wrapper.height(fb._internals.shadowHeight);fb.elements.main.container.hide();fb.elements.open.container.height(fb.settings.height.button+fb._internals.tabShadowHeight);fb.elements.open.button.height(fb.settings.height.button);if(fb.settings.display.adjustPageHeight&&fb.settings.position.bar!='inline'){var css={'margin-top':0,'margin-bottom':0};css[(fb._internals.state.top?'margin-top':'margin-bottom')]=fb._internals.offsetMargin;$('html').css(css)}if(fb._internals.state.firstrun||fb._internals.state.open){fb.utils.raise(fb.settings.events.setCollapsed,fb.settings)}fb._internals.state.open=false;if(fb.settings.cookie.enabled){fb.utils.setCookie(false)}},option:{get:function(name){return fb.utils.property.get(fb.settings,name)},set:function(name,value){if(typeof name==='string'){fb.utils.property.set(fb.settings,name,value)}else{fb.utils.property.merge(fb.settings,name)}fb.render(fb.settings)}}}})(jQuery);var google;var console;if(!window.console){console={}}console.log=console.log||function(){};console.warn=console.warn||function(){};console.error=console.error||function(){};console.info=console.info||function(){};var JSON;if(!JSON){JSON={}}JSON.stringify=JSON.stringify||function(){};